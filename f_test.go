package blake2

import (
	"encoding/hex"
	"fmt"
	"reflect"
	"testing"
)

func TestF(t *testing.T) {
	for i, test := range testVectors {
		t.Run(fmt.Sprintf("test vector %v", i), func(t *testing.T) {
			mHex, err := hex.DecodeString(test.mIn)
			if err != nil {
				t.Fatal(err)
			}

			var c [2]uint64

			// Initialization vector, see https://tools.ietf.org/html/rfc7693#section-3.3
			var h = [8]uint64{
				0x6a09e667f2bdc948, 0xbb67ae8584caa73b, 0x3c6ef372fe94f82b, 0xa54ff53a5f1d36f1,
				0x510e527fade682d1, 0x9b05688c2b3e6c1f, 0x1f83d9abfb41bd6b, 0x5be0cd19137e2179,
			}

			F(&h, mHex, &c, 0, 12)

			if !reflect.DeepEqual(test.hOut, h) {
				t.Errorf("Unexpected result\nExpected: [%v]\nActual:   [%v]\n", test.hOut, h)
			}
		})
	}
}

var testVectors = []struct {
	mIn  string
	hOut [8]uint64
}{
	// 0
	{
		mIn: "cece9d6b09747ef27164d5390e47559cf28e800f8f9f2fcefdccca9661f85952abfeaaa852fa4d4895de7452c71ae1fbddd9b68f45d51bf00bfb0602090c1521375990ea7b65e045256b91fd8e8c1aa6c1682a92bc4f0b5a66c127e911fa0b06111729406aaa14bfd49468fc6461c627ed14021719304a7bc54006474d95e277",
		hOut: [8]uint64{
			0x610cdad9429d6047, 0x7457088ba833eab1, 0x6334f520a37a47f9, 0x218f70f6e4129b3,
			0x1703fc0e2c653a6e, 0x85956e39f85ffae4, 0xe6bc1c924f07d857, 0x88a420e2dec65774,
		},
	},
	// 1
	{
		mIn: "35356a9f0aaab55f157489fe88871097a73fe6250c323f71b022d2f5c7bc8441c608cfd7a67d24a2c6682e96c55b207c9d19b7d18859e23b1e5a78d24a1d6885ee7462d73a114b5da906afb5651b809b1cb8d58d62f0524395d86e47b6fdb4b266187f9817b0c87840b9fab3ad600d6e7cea6650b708bfc88850d82800282952",
		hOut: [8]uint64{
			0xec2121394eccbe7b, 0xf6272c65c93aa388, 0x840ec08d7cbd68da, 0xe742939b30567707,
			0x150b2486fef0144, 0xffd517bb5cb24302, 0x34a7229ae4e37e67, 0x4c5038ff7f502887,
		},
	},
	// 2
	{
		mIn: "b5b56a1f89a933dc10edfdeae7d1b98b44cf13e3f6dad1ab7c27a3ca6d38a6df8564e94e3886bf46054c529ef190811294a63ae11cfd1a18324a7dc8450d5361b415c9dfa98832bbeda8963ed413e8fbe3dfc3a265086d76e45a3e99d77048b902bcbf7b3ab5f0a6963cd310e3f4d7cba36f12829517acc37034a4d97e57d52d022f326295f88d851399ac45f137296089e9725cce2af9241e4362a507adb562187b930ea1b052025558ad05b2b86a238eb13ff030215172c436fa312c5d89e77057c820e809f1fbede8d5bd9250e333164960aa0ab5c07536ace28e71007172e4563b91cd5e2b8ab641f839316b9d09a7b057086068c831fa2b255176c73e0543498dd7643ca1dd7e5cdb38134c60ac0cb9c67f46c60cd2dfb19042d315e8fde6e4caae7927a1c869329ccf6c3ba7e38b6ffa6964cd31ff30306191f28375f86e66d53b104c5daa08b2bb6e2997c05819718bfd88850e94a236d910e9fae3ddc19f61006162c426ea10fa0b0612182a436eb120d1f1c3b5792ea8d77f56d62d0330336497fb938e22b1d38458dd3512485ba3ffa2a245e72c133f5292e4775cd32f0231336599fe98972fc6f6bdb3702495b94e08565fb514cadfaa8a34bff4b3a75b025e61bf20df00e0e0c0a161026467cb32fe302f5f8fef7e6deb58439ce07d5dda38134b5eaa09b3bd702d9ecc6b38a4dc815edf3d1d5b78d34b1f6b8af57f75f4695ec826ee1504191e38568ee57459cd27f41b102c3d6aa712bacc8753da2e09374078b831ea1b052025456bb11ccdeab7a159fb544fa3f3978a22adcf7d4dca17e2f9dbd5b18738c0f9b9b26b1d89a62fd606dce2bea15f016162c325e90ef807ff06050c111d2f4d7dca47125a6dc835fd33316496fb918c1eabc9743db2efa19133c5f8beb6742ba0cc6d3aa7e1896bf46055b50ac0cb8b56e2391c5571c739013a3b76b127d901dbddb8954ee33115475da502a7aa52fc4e4a99e47d62df41216384e86d55c217d9f1cabb8642c90bd5e0b6974de43115465ca3ffa2a245e82d16445a9ef9989129bae49f8322a5c76d34a1d6784fc716def5d3c99d66036a6dd7451d627fe26144a6ea907a0b869218aac36d319fd06f40aff0a09030c0f0b0a152f345387db634ea1e0927315889e26c4fbb0bc7d2996c057177e9614bacf8a59d42e02303262a517cce4a18637bde5a3993cd602d8ebc4b08545cb00dbdca8852da2d08363e74b227da01dcdeba9852ea3d28668ef58479fd",
		hOut: [8]uint64{
			0x7feb6cd6b36fe00, 0x120fe6e3bbe2864d, 0xeaa31c182f2982d4, 0x9288f1918c892648,
			0xbdd15d561c3661fa, 0x95396e537c101e20, 0xfb451a49dbde1199, 0x7f0a0aeb25cbba27,
		},
	},
}
